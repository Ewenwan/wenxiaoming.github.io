<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="794px" preserveAspectRatio="none" style="width:1575px;height:794px;" version="1.1" viewBox="0 0 1575 794" width="1575px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wp11hstitw0v" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1wp11hstitw0v)" height="311.7896" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="382.5" y="421.1904"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="72" x2="72" y1="41.1201" y2="750.98"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="232" x2="232" y1="41.1201" y2="750.98"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="387" x2="387" y1="41.1201" y2="750.98"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="525" x2="525" y1="41.1201" y2="750.98"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="654" x2="654" y1="41.1201" y2="750.98"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="784" x2="784" y1="41.1201" y2="750.98"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="959.5" x2="959.5" y1="41.1201" y2="750.98"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1138.5" x2="1138.5" y1="41.1201" y2="750.98"/><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="15" y="26.0439">user space driver</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="8" y="749.98"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="15" y="773.0239">user space driver</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="146" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="153" y="26.0439">mali_kbase_core_linux.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="146" y="749.98"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="154" x="153" y="773.0239">mali_kbase_core_linux.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="328" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="335" y="26.0439">mali_kbase_jd.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="328" y="749.98"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="335" y="773.0239">mali_kbase_jd.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="466" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="473" y="26.0439">mali_kbase_js.h</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="466" y="749.98"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="473" y="773.0239">mali_kbase_js.h</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="595" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="602" y="26.0439">mali_kbase_js.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="595" y="749.98"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="602" y="773.0239">mali_kbase_js.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="723" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="730" y="26.0439">mali_kbase_jm.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="723" y="749.98"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="730" y="773.0239">mali_kbase_jm.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="888.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="895.5" y="26.0439">mali_kbase_jm_rb.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="888.5" y="749.98"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="895.5" y="773.0239">mali_kbase_jm_rb.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="1065.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="1072.5" y="26.0439">mali_kbase_jm_hw.c</text><rect fill="#FEFECE" filter="url(#f1wp11hstitw0v)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="1065.5" y="749.98"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="1072.5" y="773.0239">mali_kbase_jm_hw.c</text><rect fill="#FFFFFF" filter="url(#f1wp11hstitw0v)" height="311.7896" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="382.5" y="421.1904"/><polygon fill="#A80036" points="220,66.9973,230,70.9973,220,74.9973,224,70.9973" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72" x2="226" y1="70.9973" y2="70.9973"/><path d="M237,56.1201 L237,83.1201 L433,83.1201 L433,66.1201 L423,56.1201 L237,56.1201 " fill="#ADD8E6" filter="url(#f1wp11hstitw0v)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M423,56.1201 L423,66.1201 L433,66.1201 L423,56.1201 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="243" y="76.0181">KBASE_IOCTL_JOB_SUBMIT</text><polygon fill="#A80036" points="375.5,224.1553,385.5,228.1553,375.5,232.1553,379.5,228.1553" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="232" x2="381.5" y1="228.1553" y2="228.1553"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="239" y="223.2988">kbase_jd_submit</text><path d="M392,97.8745 L392,337.8745 L712,337.8745 L712,107.8745 L702,97.8745 L392,97.8745 " fill="#ADD8E6" filter="url(#f1wp11hstitw0v)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M702,97.8745 L702,107.8745 L712,107.8745 L702,97.8745 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="398" y="117.7725">// copy all atoms from user space</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="398" y="135.5269">for (i = 0; i &lt; nr_atoms; i++) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="430" y="153.2813">struct base_jd_atom_v2 user_atom;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="430" y="171.0356">struct kbase_jd_atom *katom;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="402" y="188.79"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="430" y="206.5444">if (copy_from_user(&amp;user_atom, user_addr,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="462" y="224.2988">sizeof(user_atom)) != 0) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="462" y="242.0532">err = -EINVAL;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="462" y="259.8076">break;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="430" y="277.562">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="414" y="295.3164">need_to_try_schedule_context |=</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="446" y="313.0708">jd_submit_atom(kctx, &amp;user_atom, katom);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="398" y="330.8252">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="387.5" x2="429.5" y1="371.436" y2="371.436"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="429.5" x2="429.5" y1="371.436" y2="384.436"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="388.5" x2="429.5" y1="384.436" y2="384.436"/><polygon fill="#A80036" points="398.5,380.436,388.5,384.436,398.5,388.436,394.5,384.436" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="394.5" y="366.5796">jd_submit_atom</text><path d="M498,354.1816 L498,381.1816 L715,381.1816 L715,364.1816 L705,354.1816 L498,354.1816 " fill="#ADD8E6" filter="url(#f1wp11hstitw0v)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M705,354.1816 L705,364.1816 L715,364.1816 L705,354.1816 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="504" y="374.0796">add dependencies, validate atoms</text><polygon fill="#A80036" points="513.5,417.1904,523.5,421.1904,513.5,425.1904,517.5,421.1904" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="392.5" x2="519.5" y1="421.1904" y2="421.1904"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="399.5" y="416.334">kbase_js_sched_all</text><path d="M530,397.436 L530,424.436 L686,424.436 L686,407.436 L676,397.436 L530,397.436 " fill="#ADD8E6" filter="url(#f1wp11hstitw0v)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M676,397.436 L676,407.436 L686,407.436 L676,397.436 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="536" y="417.334">start to tigger GPU HW</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="654" x2="696" y1="457.9448" y2="457.9448"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="696" x2="696" y1="457.9448" y2="470.9448"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="655" x2="696" y1="470.9448" y2="470.9448"/><polygon fill="#A80036" points="665,466.9448,655,470.9448,665,474.9448,661,470.9448" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="661" y="453.0884">kbase_js_sched</text><polygon fill="#A80036" points="772,498.6992,782,502.6992,772,506.6992,776,502.6992" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="654" x2="778" y1="502.6992" y2="502.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="661" y="497.8428">kbase_jm_kick</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="784" x2="826" y1="534.4536" y2="534.4536"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="826" x2="826" y1="534.4536" y2="547.4536"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="785" x2="826" y1="547.4536" y2="547.4536"/><polygon fill="#A80036" points="795,543.4536,785,547.4536,795,551.4536,791,547.4536" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="791" y="529.5972">kbase_jm_next_job</text><polygon fill="#A80036" points="948,575.208,958,579.208,948,583.208,952,579.208" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="784" x2="954" y1="579.208" y2="579.208"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="791" y="574.3516">kbase_backend_run_atom</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="960" x2="1002" y1="610.9624" y2="610.9624"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1002" x2="1002" y1="610.9624" y2="623.9624"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="961" x2="1002" y1="623.9624" y2="623.9624"/><polygon fill="#A80036" points="971,619.9624,961,623.9624,971,627.9624,967,623.9624" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="967" y="606.106">kbase_backend_slot_update</text><polygon fill="#A80036" points="1127,674.4712,1137,678.4712,1127,682.4712,1131,678.4712" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="960" x2="1133" y1="678.4712" y2="678.4712"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="967" y="673.6147">kbase_job_hw_submit</text><path d="M1144,636.9624 L1144,699.9624 L1563,699.9624 L1563,646.9624 L1553,636.9624 L1144,636.9624 " fill="#ADD8E6" filter="url(#f1wp11hstitw0v)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1553,636.9624 L1553,646.9624 L1563,646.9624 L1553,636.9624 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1150" y="656.8604">// configure register then start hardware operation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="398" x="1150" y="674.6147">kbase_reg_write(kbdev, JOB_SLOT_REG(js, JS_COMMAND_NEXT),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1342" y="692.3691">JS_COMMAND_START);</text><polygon fill="#A80036" points="398.5,728.98,388.5,732.98,398.5,736.98,394.5,732.98" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="392.5" x2="1138" y1="732.98" y2="732.98"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="404.5" y="728.1235">ret</text><!--
@startuml

"user space driver" -> "mali_kbase_core_linux.c":
note right #LightBlue:KBASE_IOCTL_JOB_SUBMIT
"mali_kbase_core_linux.c" -> "mali_kbase_jd.c":kbase_jd_submit
note right #LightBlue
// copy all atoms from user space
for (i = 0; i < nr_atoms; i++) {
	struct base_jd_atom_v2 user_atom;
	struct kbase_jd_atom *katom;

	if (copy_from_user(&user_atom, user_addr,
		sizeof(user_atom)) != 0) {
		err = -EINVAL;
		break;
	}
    need_to_try_schedule_context |=
	    jd_submit_atom(kctx, &user_atom, katom);
}
end note
"mali_kbase_jd.c" -> "mali_kbase_jd.c":jd_submit_atom
note right #LightBlue: add dependencies, validate atoms
"mali_kbase_jd.c" -> "mali_kbase_js.h":kbase_js_sched_all
activate "mali_kbase_jd.c"
note right #LightBlue: start to tigger GPU HW
"mali_kbase_js.c" -> "mali_kbase_js.c":kbase_js_sched
"mali_kbase_js.c" -> "mali_kbase_jm.c":kbase_jm_kick
"mali_kbase_jm.c" -> "mali_kbase_jm.c":kbase_jm_next_job
"mali_kbase_jm.c" -> "mali_kbase_jm_rb.c":kbase_backend_run_atom
"mali_kbase_jm_rb.c" -> "mali_kbase_jm_rb.c":kbase_backend_slot_update
"mali_kbase_jm_rb.c" -> "mali_kbase_jm_hw.c":kbase_job_hw_submit
note right #LightBlue
// configure register then start hardware operation
kbase_reg_write(kbdev, JOB_SLOT_REG(js, JS_COMMAND_NEXT),
						JS_COMMAND_START);
end note
"mali_kbase_jm_hw.c" -> "mali_kbase_jd.c": ret
deactivate "mali_kbase_jd.c"
@enduml

PlantUML version 1.2019.09(Tue Aug 27 00:19:51 GMT+08:00 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 13.0.2+8
Operating System: Windows 10
OS Version: 10.0
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>