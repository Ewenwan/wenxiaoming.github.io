<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="555px" preserveAspectRatio="none" style="width:1152px;height:555px;" version="1.1" viewBox="0 0 1152 555" width="1152px" zoomAndPan="magnify"><defs><filter height="300%" id="ffby3rtssq77" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="530.75" y="26.0439">alloc memory</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="72" x2="72" y1="74.2402" y2="512.5386"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="226" x2="226" y1="74.2402" y2="512.5386"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="404" x2="404" y1="74.2402" y2="512.5386"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="570" x2="570" y1="74.2402" y2="512.5386"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="771.5" x2="771.5" y1="74.2402" y2="512.5386"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="932.5" x2="932.5" y1="74.2402" y2="512.5386"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1075.5" x2="1075.5" y1="74.2402" y2="512.5386"/><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="8" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="15" y="59.1641">user space driver</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="8" y="511.5386"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="15" y="534.5825">user space driver</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="146" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="153" y="59.1641">mali_kbase_core_linux</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="146" y="511.5386"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="153" y="534.5825">mali_kbase_core_linux</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="170" x="317" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="156" x="324" y="59.1641">mali_kbase_mem_linux.c</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="170" x="317" y="511.5386"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="156" x="324" y="534.5825">mali_kbase_mem_linux.c</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="501" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="508" y="59.1641">mali_kbase_mem.c</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="501" y="511.5386"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="508" y="534.5825">mali_kbase_mem.c</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="685.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="692.5" y="59.1641">mali_kbase_mem_pool.c</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="685.5" y="511.5386"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="692.5" y="534.5825">mali_kbase_mem_pool.c</text><rect fill="#FFB6C1" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="868.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="875.5" y="59.1641">memory manager</text><rect fill="#FFB6C1" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="868.5" y="511.5386"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="875.5" y="534.5825">memory manager</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="135" x="1006.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="1013.5" y="59.1641">mali_kbase_mem.h</text><rect fill="#FEFECE" filter="url(#ffby3rtssq77)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="135" x="1006.5" y="511.5386"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="1013.5" y="534.5825">mali_kbase_mem.h</text><polygon fill="#A80036" points="214.5,103.9946,224.5,107.9946,214.5,111.9946,218.5,107.9946" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72" x2="220.5" y1="107.9946" y2="107.9946"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="79" y="103.1382">kbase_ioctl</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="226.5" x2="268.5" y1="139.749" y2="139.749"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="268.5" x2="268.5" y1="139.749" y2="152.749"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="227.5" x2="268.5" y1="152.749" y2="152.749"/><polygon fill="#A80036" points="237.5,148.749,227.5,152.749,237.5,156.749,233.5,152.749" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="233.5" y="134.8926">kbase_api_mem_alloc</text><polygon fill="#A80036" points="392,180.5034,402,184.5034,392,188.5034,396,184.5034" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="226.5" x2="398" y1="184.5034" y2="184.5034"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="233.5" y="179.647">kbase_mem_alloc</text><polygon fill="#A80036" points="558,212.2578,568,216.2578,558,220.2578,562,216.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="404" x2="564" y1="216.2578" y2="216.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="411" y="211.4014">kbase_alloc_phy_pages</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="570" x2="612" y1="248.0122" y2="248.0122"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="612" x2="612" y1="248.0122" y2="261.0122"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="571" x2="612" y1="261.0122" y2="261.0122"/><polygon fill="#A80036" points="581,257.0122,571,261.0122,581,265.0122,577,261.0122" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="577" y="243.1558">kbase_alloc_phy_pages_helper</text><polygon fill="#A80036" points="760,288.7666,770,292.7666,760,296.7666,764,292.7666" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="570" x2="766" y1="292.7666" y2="292.7666"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="577" y="287.9102">kbase_mem_pool_alloc_pages</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="772" x2="814" y1="324.521" y2="324.521"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="814" x2="814" y1="324.521" y2="337.521"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="773" x2="814" y1="337.521" y2="337.521"/><polygon fill="#A80036" points="783,333.521,773,337.521,783,341.521,779,337.521" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="779" y="319.6646">kbase_mem_alloc_page</text><polygon fill="#A80036" points="920.5,370.2754,930.5,374.2754,920.5,378.2754,924.5,374.2754" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="772" x2="926.5" y1="374.2754" y2="374.2754"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="779" y="369.4189">alloc_pages</text><path d="M658,350.521 L658,377.521 L763,377.521 L763,360.521 L753,350.521 L658,350.521 " fill="#ADD8E6" filter="url(#ffby3rtssq77)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M753,350.521 L753,360.521 L763,360.521 L753,350.521 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="664" y="370.4189">allocate pages</text><polygon fill="#A80036" points="920.5,412.0298,930.5,416.0298,920.5,420.0298,924.5,416.0298" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="772" x2="926.5" y1="416.0298" y2="416.0298"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="779" y="411.1733">dma_map_page</text><path d="M564,392.2754 L564,419.2754 L763,419.2754 L763,402.2754 L753,392.2754 L564,392.2754 " fill="#ADD8E6" filter="url(#ffby3rtssq77)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M753,392.2754 L753,402.2754 L763,402.2754 L753,392.2754 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="570" y="412.1733">allocate dma buf for further use</text><polygon fill="#A80036" points="1064,448.7842,1074,452.7842,1064,456.7842,1068,452.7842" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="772" x2="1070" y1="452.7842" y2="452.7842"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="779" y="447.9277">kbase_set_dma_addr</text><polygon fill="#A80036" points="943.5,485.5386,933.5,489.5386,943.5,493.5386,939.5,489.5386" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="937.5" x2="1075" y1="489.5386" y2="489.5386"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="949.5" y="484.6821">set_page_private</text><path d="M706,465.7842 L706,492.7842 L923,492.7842 L923,475.7842 L913,465.7842 L706,465.7842 " fill="#ADD8E6" filter="url(#ffby3rtssq77)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M913,465.7842 L913,475.7842 L923,475.7842 L913,465.7842 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="712" y="485.6821">store dma_addr in page's attribute</text><!--
@startuml


title alloc memory
"user space driver" -> "mali_kbase_core_linux":kbase_ioctl
"mali_kbase_core_linux" ->"mali_kbase_core_linux":kbase_api_mem_alloc
"mali_kbase_core_linux" -> "mali_kbase_mem_linux.c":kbase_mem_alloc
"mali_kbase_mem_linux.c" -> "mali_kbase_mem.c":kbase_alloc_phy_pages
"mali_kbase_mem.c" -> "mali_kbase_mem.c":kbase_alloc_phy_pages_helper
"mali_kbase_mem.c" -> "mali_kbase_mem_pool.c":kbase_mem_pool_alloc_pages
"mali_kbase_mem_pool.c" -> "mali_kbase_mem_pool.c":kbase_mem_alloc_page

participant "memory manager" #LightPink

"mali_kbase_mem_pool.c"-> "memory manager":alloc_pages
note left #LightBlue: allocate pages
"mali_kbase_mem_pool.c"-> "memory manager":dma_map_page
note left #LightBlue: allocate dma buf for further use
"mali_kbase_mem_pool.c"-> "mali_kbase_mem.h":kbase_set_dma_addr
"mali_kbase_mem.h"-> "memory manager":set_page_private
note left #LightBlue: store dma_addr in page's attribute


@enduml

PlantUML version 1.2019.09(Tue Aug 27 00:19:51 GMT+08:00 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 13.0.2+8
Operating System: Windows 10
OS Version: 10.0
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>