<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1660px" preserveAspectRatio="none" style="width:1246px;height:1660px;" version="1.1" viewBox="0 0 1246 1660" width="1246px" zoomAndPan="magnify"><defs><filter height="300%" id="f3ywekbl3cew2" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="580.25" y="26.0439">start session</text><rect fill="#FFFFFF" filter="url(#f3ywekbl3cew2)" height="572.8247" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="687.5" y="492.293"/><rect fill="#FFFFFF" filter="url(#f3ywekbl3cew2)" height="279.9124" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="829.5" y="1171.3809"/><rect fill="#FFFFFF" filter="url(#f3ywekbl3cew2)" height="87.5088" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1077" y="1504.9248"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="47" x2="47" y1="74.2402" y2="1617.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="154" x2="154" y1="74.2402" y2="1617.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="256.5" x2="256.5" y1="74.2402" y2="1617.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="355.5" x2="355.5" y1="74.2402" y2="1617.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="477.5" x2="477.5" y1="74.2402" y2="1617.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="586.5" x2="586.5" y1="74.2402" y2="1617.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="692.5" x2="692.5" y1="74.2402" y2="1617.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="834.5" x2="834.5" y1="74.2402" y2="1617.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="952.5" x2="952.5" y1="74.2402" y2="1617.4336"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1081.5" x2="1081.5" y1="74.2402" y2="1617.4336"/><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="8" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="15" y="59.1641">pipeline.c</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="8" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="15" y="1639.4775">pipeline.c</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="96" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="103" y="59.1641">BlenderSession</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="96" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="103" y="1639.4775">BlenderSession</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="227.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="234.5" y="59.1641">Scene</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="227.5" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="234.5" y="1639.4775">Scene</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="295.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="302.5" y="59.1641">ShaderManager</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="295.5" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="302.5" y="1639.4775">ShaderManager</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="425.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="432.5" y="59.1641">ShaderGraph</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="425.5" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="432.5" y="1639.4775">ShaderGraph</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="539.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="546.5" y="59.1641">OutputNode</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="539.5" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="546.5" y="1639.4775">OutputNode</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="643.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="650.5" y="59.1641">BlenderSync</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="643.5" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="650.5" y="1639.4775">BlenderSync</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="800.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="807.5" y="59.1641">Session</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="800.5" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="807.5" y="1639.4775">Session</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="878.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="885.5" y="59.1641">SVMShaderManager</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="145" x="878.5" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="885.5" y="1639.4775">SVMShaderManager</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="1037.5" y="36.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1044.5" y="59.1641">CPUDevice</text><rect fill="#FEFECE" filter="url(#f3ywekbl3cew2)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="1037.5" y="1616.4336"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1044.5" y="1639.4775">CPUDevice</text><rect fill="#FFFFFF" filter="url(#f3ywekbl3cew2)" height="572.8247" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="687.5" y="492.293"/><rect fill="#FFFFFF" filter="url(#f3ywekbl3cew2)" height="279.9124" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="829.5" y="1171.3809"/><rect fill="#FFFFFF" filter="url(#f3ywekbl3cew2)" height="87.5088" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1077" y="1504.9248"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="89" y1="107.9946" y2="107.9946"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="89" x2="89" y1="107.9946" y2="120.9946"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="48" x2="89" y1="120.9946" y2="120.9946"/><polygon fill="#A80036" points="58,116.9946,48,120.9946,58,124.9946,54,120.9946" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="54" y="103.1382">do_render_3d</text><polygon fill="#A80036" points="142.5,148.749,152.5,152.749,142.5,156.749,146.5,152.749" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="148.5" y1="152.749" y2="152.749"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="54" y="147.8926">create</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="154.5" x2="196.5" y1="184.5034" y2="184.5034"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="196.5" x2="196.5" y1="184.5034" y2="197.5034"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155.5" x2="196.5" y1="197.5034" y2="197.5034"/><polygon fill="#A80036" points="165.5,193.5034,155.5,197.5034,165.5,201.5034,161.5,197.5034" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="161.5" y="179.647">create_session</text><polygon fill="#A80036" points="244.5,225.2578,254.5,229.2578,244.5,233.2578,248.5,229.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="154.5" x2="250.5" y1="229.2578" y2="229.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="161.5" y="224.4014">new</text><polygon fill="#A80036" points="343.5,257.0122,353.5,261.0122,343.5,265.0122,347.5,261.0122" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="256.5" x2="349.5" y1="261.0122" y2="261.0122"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="263.5" y="256.1558">create</text><polygon fill="#A80036" points="465.5,288.7666,475.5,292.7666,465.5,296.7666,469.5,292.7666" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355.5" x2="471.5" y1="292.7666" y2="292.7666"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="362.5" y="287.9102">new</text><polygon fill="#A80036" points="574.5,320.521,584.5,324.521,574.5,328.521,578.5,324.521" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="477.5" x2="580.5" y1="324.521" y2="324.521"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="484.5" y="319.6646">new</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="477.5" x2="519.5" y1="356.2754" y2="356.2754"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="519.5" x2="519.5" y1="356.2754" y2="369.2754"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="478.5" x2="519.5" y1="369.2754" y2="369.2754"/><polygon fill="#A80036" points="488.5,365.2754,478.5,369.2754,488.5,373.2754,484.5,369.2754" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="484.5" y="351.4189">add</text><path d="M527,339.021 L527,366.021 L717,366.021 L717,349.021 L707,339.021 L527,339.021 " fill="#ADD8E6" filter="url(#f3ywekbl3cew2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M707,339.021 L707,349.021 L717,349.021 L707,339.021 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="533" y="358.9189">add node to the shader graph</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="477.5" x2="519.5" y1="408.407" y2="408.407"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="519.5" x2="519.5" y1="408.407" y2="421.407"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="478.5" x2="519.5" y1="421.407" y2="421.407"/><polygon fill="#A80036" points="488.5,417.407,478.5,421.407,488.5,425.407,484.5,421.407" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="484.5" y="403.5505">connect</text><path d="M72,382.2754 L72,427.2754 L468,427.2754 L468,392.2754 L458,382.2754 L72,382.2754 " fill="#ADD8E6" filter="url(#f3ywekbl3cew2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M458,382.2754 L458,392.2754 L468,392.2754 L458,382.2754 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="78" y="402.1733">// connect two node</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="375" x="78" y="419.9277">void ShaderGraph::connect(ShaderOutput *from, ShaderInput *to)</text><polygon fill="#A80036" points="142.5,456.5386,152.5,460.5386,142.5,464.5386,146.5,460.5386" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="148.5" y1="460.5386" y2="460.5386"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="54" y="455.6821">render</text><polygon fill="#A80036" points="675.5,488.293,685.5,492.293,675.5,496.293,679.5,492.293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="154.5" x2="681.5" y1="492.293" y2="492.293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="161.5" y="487.4365">sync_data</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="566.9333" y2="566.9333"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="566.9333" y2="579.9333"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="739.5" y1="579.9333" y2="579.9333"/><polygon fill="#A80036" points="708.5,575.9333,698.5,579.9333,708.5,583.9333,704.5,579.9333" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="704.5" y="562.0769">sync_integrator</text><path d="M286,505.293 L286,621.293 L678,621.293 L678,515.293 L668,505.293 L286,505.293 " fill="#ADD8E6" filter="url(#f3ywekbl3cew2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M668,505.293 L668,515.293 L678,515.293 L668,505.293 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="292" y="525.1909">// set Integrator's parameter in scene</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="292" y="542.9453">Integrator *integrator = scene-&gt;integrator;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="292" y="560.6997">Integrator previntegrator = *integrator;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="296" y="578.4541"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="292" y="596.2085">integrator-&gt;min_bounce = get_int(cscene, "min_light_bounces");</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="292" y="613.9629">integrator-&gt;max_bounce = get_int(cscene, "max_bounces");</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="654.5737" y2="654.5737"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="654.5737" y2="667.5737"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="739.5" y1="667.5737" y2="667.5737"/><polygon fill="#A80036" points="708.5,663.5737,698.5,667.5737,708.5,671.5737,704.5,667.5737" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="704.5" y="649.7173">sync_film</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="699.3281" y2="699.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="699.3281" y2="712.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="739.5" y1="712.3281" y2="712.3281"/><polygon fill="#A80036" points="708.5,708.3281,698.5,712.3281,708.5,716.3281,704.5,712.3281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="704.5" y="694.4717">sync_shaders</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="744.0825" y2="744.0825"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="744.0825" y2="757.0825"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="739.5" y1="757.0825" y2="757.0825"/><polygon fill="#A80036" points="708.5,753.0825,698.5,757.0825,708.5,761.0825,704.5,757.0825" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="704.5" y="739.2261">sync_world</text><polygon fill="#A80036" points="488.5,784.8369,478.5,788.8369,488.5,792.8369,484.5,788.8369" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="482.5" x2="686.5" y1="788.8369" y2="788.8369"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="494.5" y="783.9805">new</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="820.5913" y2="820.5913"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="820.5913" y2="833.5913"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="739.5" y1="833.5913" y2="833.5913"/><polygon fill="#A80036" points="708.5,829.5913,698.5,833.5913,708.5,837.5913,704.5,833.5913" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="704.5" y="815.7349">sync_lights</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="872.7229" y2="872.7229"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="872.7229" y2="885.7229"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="739.5" y1="885.7229" y2="885.7229"/><polygon fill="#A80036" points="708.5,881.7229,698.5,885.7229,708.5,889.7229,704.5,885.7229" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="704.5" y="867.8665">sync_materials</text><path d="M285,846.5913 L285,891.5913 L678,891.5913 L678,856.5913 L668,846.5913 L285,846.5913 " fill="#ADD8E6" filter="url(#f3ywekbl3cew2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M668,846.5913 L668,856.5913 L678,856.5913 L668,846.5913 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="317" x="291" y="866.4893">// will do shadergraph optimization as soon as possible</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="291" y="884.2437">pool.push(function_bind(&amp;ShaderGraph::simplify, graph, scene));</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="924.8545" y2="924.8545"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="924.8545" y2="937.8545"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="739.5" y1="937.8545" y2="937.8545"/><polygon fill="#A80036" points="708.5,933.8545,698.5,937.8545,708.5,941.8545,704.5,937.8545" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="704.5" y="919.998">sync_materials</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="969.6089" y2="969.6089"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="969.6089" y2="982.6089"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="739.5" y1="982.6089" y2="982.6089"/><polygon fill="#A80036" points="708.5,978.6089,698.5,982.6089,708.5,986.6089,704.5,982.6089" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="704.5" y="964.7524">sync_images</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="1014.3633" y2="1014.3633"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="1014.3633" y2="1027.3633"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="698.5" x2="739.5" y1="1027.3633" y2="1027.3633"/><polygon fill="#A80036" points="708.5,1023.3633,698.5,1027.3633,708.5,1031.3633,704.5,1027.3633" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="704.5" y="1009.5068">sync_curve_settings</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="697.5" x2="739.5" y1="1064.1177" y2="1064.1177"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="739.5" x2="739.5" y1="1064.1177" y2="1077.1177"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692.5" x2="739.5" y1="1077.1177" y2="1077.1177"/><polygon fill="#A80036" points="702.5,1073.1177,692.5,1077.1177,702.5,1081.1177,698.5,1077.1177" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="704.5" y="1059.2612">sync_motion</text><polygon fill="#A80036" points="822.5,1113.7493,832.5,1117.7493,822.5,1121.7493,826.5,1117.7493" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="154.5" x2="828.5" y1="1117.7493" y2="1117.7493"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="161.5" y="1112.8928">start</text><path d="M839,1085.1177 L839,1130.1177 L1234,1130.1177 L1234,1095.1177 L1224,1085.1177 L839,1085.1177 " fill="#ADD8E6" filter="url(#f3ywekbl3cew2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1224,1085.1177 L1224,1095.1177 L1234,1095.1177 L1224,1085.1177 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="845" y="1105.0156">// start new thread for session's run</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="845" y="1122.77">session_thread = new thread(function_bind(&amp;Session::run, this));</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="834.5" x2="881.5" y1="1158.3809" y2="1158.3809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881.5" x2="881.5" y1="1158.3809" y2="1171.3809"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="840.5" x2="881.5" y1="1171.3809" y2="1171.3809"/><polygon fill="#A80036" points="850.5,1167.3809,840.5,1171.3809,850.5,1175.3809,846.5,1171.3809" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="846.5" y="1153.5244">run()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="839.5" x2="881.5" y1="1208.1353" y2="1208.1353"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881.5" x2="881.5" y1="1208.1353" y2="1221.1353"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="840.5" x2="881.5" y1="1221.1353" y2="1221.1353"/><polygon fill="#A80036" points="850.5,1217.1353,840.5,1221.1353,850.5,1225.1353,846.5,1221.1353" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="846.5" y="1203.2788">update_scene</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="839.5" x2="881.5" y1="1252.8896" y2="1252.8896"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881.5" x2="881.5" y1="1252.8896" y2="1265.8896"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="840.5" x2="881.5" y1="1265.8896" y2="1265.8896"/><polygon fill="#A80036" points="850.5,1261.8896,840.5,1265.8896,850.5,1269.8896,846.5,1265.8896" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="846.5" y="1248.0332">device_update</text><polygon fill="#A80036" points="941,1325.2756,951,1329.2756,941,1333.2756,945,1329.2756" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="839.5" x2="947" y1="1329.2756" y2="1329.2756"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="846.5" y="1324.4192">device_update</text><path d="M234,1278.8896 L234,1359.8896 L820,1359.8896 L820,1288.8896 L810,1278.8896 L234,1278.8896 " fill="#ADD8E6" filter="url(#f3ywekbl3cew2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M810,1278.8896 L810,1288.8896 L820,1288.8896 L810,1278.8896 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="240" y="1298.7876">task_pool.push(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="256" y="1316.542">function_bind(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="541" x="264" y="1334.2964">&amp;SVMShaderManager::device_update_shader, this, scene, shader, &amp;progress, &amp;svm_nodes),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="256" y="1352.0508">false);</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="839.5" x2="881.5" y1="1392.6616" y2="1392.6616"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="881.5" x2="881.5" y1="1392.6616" y2="1405.6616"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="840.5" x2="881.5" y1="1405.6616" y2="1405.6616"/><polygon fill="#A80036" points="850.5,1401.6616,840.5,1405.6616,850.5,1409.6616,846.5,1405.6616" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="846.5" y="1387.8052">render</text><polygon fill="#A80036" points="1070,1447.2932,1080,1451.2932,1070,1455.2932,1074,1451.2932" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="834.5" x2="1076" y1="1451.2932" y2="1451.2932"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="841.5" y="1446.4368">task_add</text><path d="M509,1418.6616 L509,1463.6616 L820,1463.6616 L820,1428.6616 L810,1418.6616 L509,1418.6616 " fill="#ADD8E6" filter="url(#f3ywekbl3cew2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M810,1418.6616 L810,1428.6616 L820,1428.6616 L810,1418.6616 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="515" y="1438.5596">foreach (DeviceTask &amp;task, tasks)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="523" y="1456.314">task_pool.push(new CPUDeviceTask(this, task));</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1082" x2="1129" y1="1491.9248" y2="1491.9248"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1129" x2="1129" y1="1491.9248" y2="1504.9248"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1088" x2="1129" y1="1504.9248" y2="1504.9248"/><polygon fill="#A80036" points="1098,1500.9248,1088,1504.9248,1098,1508.9248,1094,1504.9248" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1094" y="1487.0684">thread_run</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1087" x2="1129" y1="1541.6792" y2="1541.6792"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1129" x2="1129" y1="1541.6792" y2="1554.6792"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1088" x2="1129" y1="1554.6792" y2="1554.6792"/><polygon fill="#A80036" points="1098,1550.6792,1088,1554.6792,1098,1558.6792,1094,1554.6792" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="1094" y="1536.8228">thread_render</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1087" x2="1129" y1="1591.4336" y2="1591.4336"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1129" x2="1129" y1="1591.4336" y2="1604.4336"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1082" x2="1129" y1="1604.4336" y2="1604.4336"/><polygon fill="#A80036" points="1092,1600.4336,1082,1604.4336,1092,1608.4336,1088,1604.4336" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1094" y="1586.5771">path_trace</text><path d="M949,1569.1792 L949,1596.1792 L1068,1596.1792 L1068,1579.1792 L1058,1569.1792 L949,1569.1792 " fill="#ADD8E6" filter="url(#f3ywekbl3cew2)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1058,1569.1792 L1058,1579.1792 L1068,1579.1792 L1058,1569.1792 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="955" y="1589.0771">start path tracing</text><!--
@startuml
title start session
"pipeline.c" -> "pipeline.c":do_render_3d
"pipeline.c" -> BlenderSession:create
BlenderSession -> BlenderSession:create_session
BlenderSession -> Scene:new
Scene->ShaderManager:create
ShaderManager -> ShaderGraph:new
ShaderGraph -> OutputNode:new
ShaderGraph -> ShaderGraph:add
note right #LightBlue: add node to the shader graph 
ShaderGraph ->ShaderGraph:connect
note left #LightBlue
// connect two node
void ShaderGraph::connect(ShaderOutput *from, ShaderInput *to)
end note
"pipeline.c" -> BlenderSession:render
BlenderSession -> BlenderSync:sync_data
activate BlenderSync
BlenderSync -> BlenderSync:sync_integrator
note left #LightBlue
  // set Integrator's parameter in scene
  Integrator *integrator = scene->integrator;
  Integrator previntegrator = *integrator;

  integrator->min_bounce = get_int(cscene, "min_light_bounces");
  integrator->max_bounce = get_int(cscene, "max_bounces");
end note
BlenderSync -> BlenderSync:sync_film
BlenderSync -> BlenderSync:sync_shaders
BlenderSync -> BlenderSync:sync_world
BlenderSync -> ShaderGraph:new
BlenderSync -> BlenderSync:sync_lights
BlenderSync -> BlenderSync:sync_materials
note left #LightBlue
// will do shadergraph optimization as soon as possible
pool.push(function_bind(&ShaderGraph::simplify, graph, scene));
end note
BlenderSync -> BlenderSync:sync_materials
BlenderSync -> BlenderSync:sync_images
BlenderSync -> BlenderSync:sync_curve_settings
BlenderSync -> BlenderSync:sync_motion
deactivate BlenderSync

BlenderSession ->Session:start
note right #LightBlue
// start new thread for session's run
session_thread = new thread(function_bind(&Session::run, this));
end note
Session -> Session:run()
activate Session
Session -> Session:update_scene
Session -> Session:device_update
Session -> SVMShaderManager:device_update
note left #LightBlue
task_pool.push(
    function_bind(
      &SVMShaderManager::device_update_shader, this, scene, shader, &progress, &svm_nodes),
    false);
end note
Session -> Session:render
Session -> CPUDevice:task_add
note left #LightBlue
foreach (DeviceTask &task, tasks)
  task_pool.push(new CPUDeviceTask(this, task));
end note
deactivate Session
CPUDevice ->CPUDevice:thread_run
activate CPUDevice
CPUDevice ->CPUDevice:thread_render
CPUDevice ->CPUDevice:path_trace
note left #LightBlue: start path tracing
deactivate CPUDevice
@enduml

PlantUML version 1.2019.09(Tue Aug 27 00:19:51 GMT+08:00 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 13.0.2+8
Operating System: Windows 10
OS Version: 10.0
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>